# TIL-20190813/Security - HMAC

# HMAC?

HMAC (Hash-based Message Authentication Code)은 해싱 기법을 이용하여 메시지의 위변조를 방지하는 기법이다. 

서버와 클라이언트를 예로 들어보자.

서버는 자신이 허용한 클라이언트에게 데이터를 제공한다고 했을 때 신원을 보장할 수 있는 수단이 필요하다. 이 때 서버와 클라이언트가 서로 공유하고 있는 비밀 키(secret key)를 기준으로 **SHA-256** 같은 암호화 알고리즘을 통해 어떤 해시 값을 만들어 낸다. 

이 해시 값을 **HMAC**이라고 하며, 주고 받는 값 자체와 비밀 키를 포함해서 만든 해시이다. 따라서 서버는 클라이언트에게 HMAC을 전달 받게 되면 자신이 가진 비밀 키와 본문 값을 통해 만든 해시 값(결국 HMAC)과 비교한다. HMAC이 서로 다르다면 위변조 된 요청으로 간주하는 것이다.

# in JWT

JWT(JSON web token)은 JSON 기반으로 만든 토큰이다. 서버와 클라이언트가 인증을 위해 JWT를 사용한다면 JWT 안에 필요한 값과 만료 시간 등을 저장해서 갖고 다닐 수 있다. 

하지만 서버는 클라이언트에게 발급한 JWT에 대해 어떠한 상태 값도 보관하지 않지 않기 때문에 클라이언트가 전송한 JWT에 대한 검증 수단이 필요하다.

JWT 구조상 마지막 부분에 붙어 있는 Signature 부분이 바로 HMAC을 사용한 방식이다. JWT의 Header와 Payload 부분, 그리고 비밀 키를 기반으로 해시한 값을 HMAC으로 사용함으로써 클라이언트 JWT가 유출 되더라도 HMAC Signature를 통해 유효성 여부를 판단할 수 있다.

ㄴ